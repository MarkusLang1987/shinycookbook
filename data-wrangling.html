<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Data Wrangling | R Shiny Cookbook</title>
  <meta name="description" content="2 Data Wrangling | R Shiny Cookbook" />
  <meta name="generator" content="bookdown 0.10 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Data Wrangling | R Shiny Cookbook" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Data Wrangling | R Shiny Cookbook" />
  
  
  

<meta name="author" content="Markus Lang" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="preface.html">
<link rel="next" href="interactive-data-visualisation.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i><b>1</b> Preface</a><ul>
<li class="chapter" data-level="1.1" data-path="preface.html"><a href="preface.html#what-this-book-will-cover"><i class="fa fa-check"></i><b>1.1</b> What this book will cover</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-wrangling.html"><a href="data-wrangling.html"><i class="fa fa-check"></i><b>2</b> Data Wrangling</a><ul>
<li class="chapter" data-level="2.1" data-path="data-wrangling.html"><a href="data-wrangling.html#data-wrangling-with-dplyr"><i class="fa fa-check"></i><b>2.1</b> Data Wrangling with dplyr</a><ul>
<li class="chapter" data-level="2.1.1" data-path="data-wrangling.html"><a href="data-wrangling.html#nse-and-tidy-evaluation"><i class="fa fa-check"></i><b>2.1.1</b> NSE and Tidy evaluation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="interactive-data-visualisation.html"><a href="interactive-data-visualisation.html"><i class="fa fa-check"></i><b>3</b> Interactive Data Visualisation</a><ul>
<li class="chapter" data-level="3.1" data-path="interactive-data-visualisation.html"><a href="interactive-data-visualisation.html#the-highcharter-package"><i class="fa fa-check"></i><b>3.1</b> The highcharter Package</a><ul>
<li class="chapter" data-level="3.1.1" data-path="interactive-data-visualisation.html"><a href="interactive-data-visualisation.html#barchart"><i class="fa fa-check"></i><b>3.1.1</b> Barchart</a></li>
<li class="chapter" data-level="3.1.2" data-path="interactive-data-visualisation.html"><a href="interactive-data-visualisation.html#scatterplot"><i class="fa fa-check"></i><b>3.1.2</b> Scatterplot</a></li>
<li class="chapter" data-level="3.1.3" data-path="interactive-data-visualisation.html"><a href="interactive-data-visualisation.html#linechart"><i class="fa fa-check"></i><b>3.1.3</b> Linechart</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="html.html"><a href="html.html"><i class="fa fa-check"></i><b>4</b> HTML</a></li>
<li class="chapter" data-level="5" data-path="css.html"><a href="css.html"><i class="fa fa-check"></i><b>5</b> CSS</a></li>
<li class="chapter" data-level="6" data-path="bootstrap.html"><a href="bootstrap.html"><i class="fa fa-check"></i><b>6</b> Bootstrap</a></li>
<li class="chapter" data-level="7" data-path="javascript.html"><a href="javascript.html"><i class="fa fa-check"></i><b>7</b> JavaScript</a></li>
<li class="chapter" data-level="8" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>8</b> Git</a><ul>
<li class="chapter" data-level="8.1" data-path="git.html"><a href="git.html#git-is-a-version-control-system-that-allows-you-to-track-changes-with-time-points-and-to-work-on-the-same-project-with-different-people-regardless-of-location.-git-is-an-absolute-prerequisite-in-the-industry-and-is-being-adapted-more-and-more-in-the-field-of-data-science.-this-chapters-how-to-install-and-use-git."><i class="fa fa-check"></i><b>8.1</b> Git is a version control system that allows you to track changes with time points and to work on the same project with different people regardless of location. Git is an absolute prerequisite in the industry and is being adapted more and more in the field of data science. This chapters how to install and use git.</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="linux-basics.html"><a href="linux-basics.html"><i class="fa fa-check"></i><b>9</b> Linux Basics</a><ul>
<li class="chapter" data-level="9.1" data-path="linux-basics.html"><a href="linux-basics.html#set-up-r-shiny-on-a-linux-ubuntu-18.04-vm"><i class="fa fa-check"></i><b>9.1</b> Set up R-Shiny on a Linux Ubuntu 18.04 VM</a></li>
<li class="chapter" data-level="9.2" data-path="linux-basics.html"><a href="linux-basics.html#installing-packages"><i class="fa fa-check"></i><b>9.2</b> Installing packages</a></li>
<li class="chapter" data-level="9.3" data-path="linux-basics.html"><a href="linux-basics.html#use-linux-to-automatically-send-reports"><i class="fa fa-check"></i><b>9.3</b> Use Linux to automatically send reports</a></li>
<li class="chapter" data-level="9.4" data-path="linux-basics.html"><a href="linux-basics.html#daily-reports-with-mails-gmail"><i class="fa fa-check"></i><b>9.4</b> Daily reports with mails (Gmail):</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="deploy-shiny-apps-on-your-own-website.html"><a href="deploy-shiny-apps-on-your-own-website.html"><i class="fa fa-check"></i><b>10</b> Deploy Shiny apps on your own website</a></li>
<li class="chapter" data-level="11" data-path="deploy-shiny-apps-on-your-own-website-1.html"><a href="deploy-shiny-apps-on-your-own-website-1.html"><i class="fa fa-check"></i><b>11</b> Deploy Shiny apps on your own website</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Shiny Cookbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-wrangling" class="section level1">
<h1><span class="header-section-number">2</span> Data Wrangling</h1>
<p>This chapter does not deal with the data wrangling itself, but with how to calculate the numbers as quickly as possible from a data set that has already been cleaned up, and how to display them in the dashboard. The reason for this is that R-Shiny applications should always load fast readable and clean data sets, because this is an essential factor for a good performance of the app.</p>
<div id="data-wrangling-with-dplyr" class="section level2">
<h2><span class="header-section-number">2.1</span> Data Wrangling with dplyr</h2>
<p>Dashboards are often used to quickly and easily display differences between groups. This workflow perfectly fits to using dplyr, which with its simple pipe syntax allows you to create code that is easy for others to read.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
result &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">meanmpg =</span> <span class="kw">mean</span>(mpg, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))
<span class="kw">print</span>(result)</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##     cyl meanmpg
##   &lt;dbl&gt;   &lt;dbl&gt;
## 1     4    26.7
## 2     6    19.7
## 3     8    15.1</code></pre>
<p>Easy to write, easy to read! But in Shiny Apps, but often might have to write code like this many times, for example when you want to group by different variables. Maybe you have heard this:</p>
<blockquote>
<p>When you’ve written the same code 3 times, write a function</p>
<p>– <cite>Hadley Wickham</cite></p>
</blockquote>
<p>Nothing easier than this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grouped_mean &lt;-<span class="st"> </span><span class="cf">function</span>(data, group, sumvar) {
    result &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">group_by</span>(group) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">summarise</span>(<span class="dt">rumresult =</span> <span class="kw">mean</span>(sumvar, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))
    <span class="kw">return</span>(result)
}

<span class="kw">grouped_mean</span>(mtcars, cyl, mpg)</code></pre></div>
<pre><code>## Error in grouped_df_impl(data, unname(vars), drop): Column `group` is unknown</code></pre>
<p>The error shows, that dplyr was not able to find the grouping variable. The reason for this is something called non-standard-evaluation (NSE). This expression is a term that covers everything that does not follow the standard rules of R evaluation. NSE is archieved with meta programming techniques which allow the programmer to manipulate the way R evaluates functions. NSE allows to write code without referring to the dataframe: <code>group_by(cyl)</code> instead of <code>group_by(mtcars$cyl)</code>. Get more and in depth information about this topic here:</p>
<p><a href="https://adv-r.hadley.nz/">Advanced R by Hadley Wickham</a> <br> <a href="Wickham%5Dhttps://www.amazon.de/Metaprogramming-Advanced-Statistical-Programming-Analysis/dp/1484228804/ref=sr_1_1?__mk_de_DE=%C3%85M%C3%85%C5%BD%C3%95%C3%91&amp;keywords=metaprogramming+r&amp;qid=1555258801&amp;s=gateway&amp;sr=8-1">Metaprogramming in R: Advanced Statistical Programming for Data Science, Analysis and Finance by Thomas Mailund</a></p>
<p>This ease of use comes with the drawback that dplyr is refencially not transparent. For functions you just could use base R functions, but dplyr also preserves functions which use standard evaluation.</p>
<div id="nse-and-tidy-evaluation" class="section level3">
<h3><span class="header-section-number">2.1.1</span> NSE and Tidy evaluation</h3>
<p>Before version 0.8.0 most dplyr functions had a “_&quot; equivalent. Since dplyr 0.8.0 there is a new and easier option to use dplyr code in custom functions. dplyr 0.8.0 allows to use something called tidy evaluation. The key principle behind tidy evaluation, instead of evaluating the arguments, is to quote arguments which refer to data frame columns and unquote them in the process.</p>
<p>Quoting a variable is archieved with the <code>enquo()</code> function. The quoted arguments get passed to the function get passed to the function and will get evaluated when being unquoted with <code>!!</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grouped_mean &lt;-<span class="st"> </span><span class="cf">function</span>(data, group, sumvar) {
    
    group &lt;-<span class="st"> </span><span class="kw">enquo</span>(group)
    sumvar &lt;-<span class="st"> </span><span class="kw">enquo</span>(sumvar)
  
    result &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">group_by</span>(<span class="op">!!</span>group) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">summarise</span>(<span class="dt">sumresult =</span> <span class="kw">mean</span>(<span class="op">!!</span>sumvar, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))
    <span class="kw">return</span>(result)
}

<span class="kw">grouped_mean</span>(mtcars, cyl, mpg)</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##     cyl sumresult
##   &lt;dbl&gt;     &lt;dbl&gt;
## 1     4      26.7
## 2     6      19.7
## 3     8      15.1</code></pre>
<p>This works perfectly fine and allows you to get rid of repetitive code. The topic tidy evaluation is of course much more extensive than what was shown in this chapter. Further information on this topic can be found here:</p>
<p><a href="https://dplyr.tidyverse.org/articles/programming.html#quoting">dplyr 0.8.0 documentation</a> <br> <a href="https://tidyeval.tidyverse.org/index.html">Tidy evaluation by Hadley Wickham</a></p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="preface.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="interactive-data-visualisation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

</body>

</html>
